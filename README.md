# 🀄 直式手機版麻將｜Taiwan 16 Tiles — Portrait UI

> **版本**：v2.0 ・ **更新時間**：2025-10-23（Asia/Taipei）  
> **平台**：純前端（HTML/CSS/JS，零相依）・可直接以行動裝置瀏覽器開啟  
> **亮點**：單手操作、同屏關鍵資訊、可遊玩流程、含音效與特效（可關閉）

本 README 對應檔案：`mobile_portrait_full_fx.html`（完整版、含音效特效）。
如需精簡版請改用 `mobile_portrait_full_actions.html` 或 `mobile_portrait_single_screen_playable.html`。

---

## 目錄

- [功能總覽](#功能總覽)
- [快速開始](#快速開始)
- [介面導覽（直式堆疊）](#介面導覽直式堆疊)
- [操作說明](#操作說明)
- [規則與限制](#規則與限制)
- [音效與特效](#音效與特效)
- [相容性與效能](#相容性與效能)
- [自訂與佈景](#自訂與佈景)
- [程式架構](#程式架構)
- [Roadmap](#roadmap)
- [常見問題（FAQ）](#常見問題faq)
- [授權與版本](#授權與版本)

---

## 功能總覽

- 📱 **直式堆疊 UI（One‑screen Info）**：戰況、牌局資訊、反應鈕、你的手牌、四家區塊依序垂直排列；**手牌自動等寬縮放**，不需橫向捲動。  
- 🧠 **完整流程**：發牌／定莊 → 摸打循環 → 吃碰槓 → 胡牌與結束。  
- 🧩 **反應優先權**：**胡 ＞ 槓 ＞ 碰 ＞ 吃**，出牌後依序判斷三家反應。  
- 🍜 **吃**（僅下家）、**碰**、**槓**（明槓／暗槓／加槓），槓後自動補摸、回合保留。  
- 🎯 **胡牌判定**：一般胡（五面子一將）＋七對（四張視兩對）。  
- 🔔 **聽牌提示**：即時計算等待牌，顯示於手牌下方（提示用，非強制）。  
- 🔊 **音效**＋✨ **特效**：摸、打、吃碰槓、胡牌皆有；可於頂部 pill 即時開關。  
- 🤖 **AI 對手**：輕量策略（優先暗槓、出非字牌）確保流程順暢可測。  
- 🧪 **零相依**：單檔可跑，支援 GitHub Pages／任何靜態主機。

---

## 快速開始

1. 以手機瀏覽器開啟 `mobile_portrait_full_fx.html`（或部署到任一靜態主機）。  
2. 點「**開始新局**」。  
3. 你為 **東家** 先出，其他三家為內建 AI。

> 建議在 **HTTPS** 環境下使用（行動瀏覽器首次互動後會解鎖 WebAudio 音效）。

---

## 介面導覽（直式堆疊）

1. **頂部工具列**：顯示規則／底台、**音效**與**特效**開關、開始新局。  
2. **資訊列（雙欄）**  
   - 左：**戰況**（系統、你、AI 的摸打與吃碰槓胡紀錄）。  
   - 右：**牌局資訊**（場風、圈數、莊家、剩餘張數、金牌預留、骰子）。  
3. **反應鈕列**：胡、吃、碰、槓、聽、過（僅可用時高亮；吃／槓會彈出可選組合）。  
4. **你的手牌**：一行顯示、等寬自適應；下方顯示**聽牌提示**。  
5. **四位玩家區**：顯示座位／是否莊家／分數（示意）／手張數、**捨牌列**與**副露列**。

---

## 操作說明

- **出牌**：點擊你的任一手牌即打出。  
- **摸牌**：輪到你且需摸牌時，按「**過**」或依畫面提示自動摸。  
- **吃**：只有**下家**可吃；若有多組順子，會跳出選單讓你選。  
- **碰**：手內兩張＋他家一張。  
- **槓**：  
  - **暗槓**：自己回合、手內四張相同。  
  - **明槓**：手三張＋他家一張（對最後捨牌）。  
  - **加槓**：已碰的刻子，在自己回合補到第四張。  
  槓後 **自動補摸**，**回合仍在你**。  
- **聽**：顯示等待牌，不會鎖定手牌。  
- **胡**：可胡時「胡牌」會亮起；自摸或吃胡皆觸發音效＋彩帶／煙火特效。

---

## 規則與限制

**核心規則（已實作）**

| 類別 | 說明 |
|---|---|
| 起手 | 莊 17、閒 16（16 張制） |
| 摸打 | 每回合摸 1 打 1，維持牌量 |
| 吃 | 僅下家可吃，僅數牌可順子 |
| 碰 | 任一家可碰 |
| 槓 | 暗／明／加槓；槓後補摸、回合保留 |
| 胡牌 | 一般胡（五面子一將）＋七對 |
| 優先 | **胡 ＞ 槓 ＞ 碰 ＞ 吃** |
| 流程 | 出牌 → 三家依序反應 → 無人反應則下一家摸打 |

**目前限制（可擴充）**

- 尚未包含：**台數／底台結算**、自摸／放槍分配、連莊、金牌（Joker）實作、搶槓／包牌、花牌／補花、十三么等特殊役。  
- 沒有「多家同時胡」的結算動畫與分配（可加）。  
- AI 為示意策略，非最佳化。

> 上述項目皆已預留鉤點，可依你的版本規則逐項開啟。

---

## 音效與特效

- **音效（SFX）**：摸、打、吃／碰／槓、點擊、胡牌。使用 WebAudio 即時合成，無需外部音檔。  
- **特效（FX）**：胡牌觸發彩帶／煙火；整體基於 `<canvas>`。  
- **開關**：頂部 pill「🔊 音效」「✨ 特效」可即時切換。

---

## 相容性與效能

- **瀏覽器**：iOS Safari、Android Chrome、最新 Edge/Chrome 行動版。  
- **音效授權**：行動瀏覽器需使用者與頁面互動後（點任何按鈕）才能播放音效。  
- **效能**：UI 採 CSS 變數與原生動畫；聽牌計算具快取，16 張也流暢。

---

## 自訂與佈景

可在 CSS 變數覆寫以下值：

```css
:root{
  --tileW: 42px;   /* 手牌寬度（通常由 JS 自動計算，必要時可覆寫） */
  --tileH: 56px;   /* 手牌高度 */
  --miniW: 28px;   /* 捨牌／副露牌寬 */
  --miniH: 38px;   /* 捨牌／副露牌高 */
  --bg1: #0e2740;  /* 背景漸層一 */
  --bg2: #0b1e32;  /* 背景漸層二 */
  --shadow: 0 4px 14px rgba(0,0,0,.18);
}
```

- **關閉音效／特效**：頂部 pill 即時切換。  
- **字型**：建議引入 Noto Sans TC / Inter 等；或使用系統字體堆疊。  
- **牌色系**：數萬／筒／條與字牌顏色可在 `.tile.w/.t/.s/.z/.f/.b` 調整。

---

## 程式架構

- **狀態容器 `G`**：牌山、當前回合、最後捨牌、四家資料（`hand[]/disc[]/melds[]/banker` 等）。  
- **核心流程**：  
  - `setup()` → 洗牌／發牌／開局。  
  - 玩家出牌 `onYouTapTile()` → 設置最後捨牌。  
  - `resolveClaimsAfterDiscard()`：依 **胡＞槓＞碰＞吃** 檢查三家反應。  
  - 無人反應 → `scheduleAiChain()` 讓下一家摸打。  
- **AI**：`aiTurn()`（需摸則摸；可暗槓優先；否則打第一張非字牌）。  
- **規則判定**：  
  - `canHuFull()`（一般胡＋七對）、`chiOptions()`、`canPengBy()`、`canMeldGang()`。  
- **SFX/FX**：`SFX`（WebAudio 產音）、`fxLayer`（Canvas 彩帶／煙火）。

---

## Roadmap

- ✅ 直式堆疊 UI、音效／特效、七對、三種槓、反應優先權、AI 串連出牌。  
- ⏭️ 台數／結算／飛分動畫、金牌與海底規則、同時胡處理。  
- ⏭️ 回放／牌譜匯出（JSON／GIF／文字）、戰績面板、PWA（離線可玩）。  
- ⏭️ 進階 AI（向聽數、期望值、守備）。

---

## 常見問題（FAQ）

**Q1：第三家會不會卡住？**  
A：已修正。丟牌後統一走「判反應 → 無人反應才輪轉」，不會卡關。

**Q2：手機上手牌會擠不下？**  
A：本版採「自動等寬縮放」，保證一行完整顯示手牌。

**Q3：要加台數、金牌、連莊？**  
A：OK。提供你的**台灣 16 張規則表**（底／台、加台條件、金牌、搶槓、包牌、連莊等），我即可接上完整結算與動畫。

---

## 授權與版本

- **授權**：此程式碼供你的專案內部或站點使用；若需對外開源，我可加入 LICENSE 與版權宣告。  
- **版本**：`v2.0`（2025-10-23，Asia/Taipei）。

---

> 建議把此 README 與 `mobile_portrait_full_fx.html` 一同部署。若要我把台數結算與金牌規則整合，交付 v2.1，丟規則表來就上工！
